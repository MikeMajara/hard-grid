{"version":3,"file":"index.js","sources":["../src/defaults.ts","../src/helpers.ts","../src/GridComponent.tsx"],"sourcesContent":["export const defaultMarginTop = 10\nexport const defaultMarginRight = 10\nexport const defaultMarginBottom = 10\nexport const defaultMarginLeft = 10\n\nexport const defaultItemHeight = 40;\nexport const defaultItemWidth = 40;","import { Position } from \"./main\"\nimport { AnimatedValue } from 'react-spring'\nimport {\n  defaultMarginRight,\n  defaultMarginLeft,\n  defaultMarginTop,\n  defaultMarginBottom,\n\n  defaultItemHeight,\n  defaultItemWidth\n} from './defaults'\n\nexport const calculateLayout = (\n  elements: React.ReactElement[],\n  marginTop: number,\n  marginRight: number,\n  marginBottom: number,\n  marginLeft: number,\n  containerWidth: number\n): Position[] => {\n  // let t0 = performance.now()\n  let currentRow = 0\n  let currentTopOffset = 0\n  let currentLeftOffset = 0\n  let spaceRemainingX = containerWidth\n  \n  const nextRow = () => {\n    currentRow += 1\n    currentTopOffset += marginTop + defaultItemHeight + marginBottom\n    currentLeftOffset = 0\n    spaceRemainingX = containerWidth\n  }\n\n  const positions: Position[] = []\n  \n  elements.forEach((e, i) => {\n    let elementWidth = e.props.style.width\n    // FIX - If the elements' values are AnimatedValues,\n    // we need to extract the actual width value from there.\n    if (typeof elementWidth === \"object\") {elementWidth = elementWidth.value}\n\n    const necessarySpaceX = marginLeft + elementWidth + marginRight\n    if (\n      // FIXME -- There is a weird behavior because of bigger boxes than the\n      // container width. which makes the grid behave weirdly. Maybe if boxes \n      // are wider than container width we always need to jump line.\n      (spaceRemainingX <= necessarySpaceX && \n      containerWidth > necessarySpaceX) || \n      (necessarySpaceX >= containerWidth && i !== 0)\n    ){\n      nextRow()\n    }\n    positions.push({\n      row: currentRow,\n      top: currentTopOffset + marginTop,\n      left: currentLeftOffset + marginLeft\n    })\n    spaceRemainingX -= necessarySpaceX\n    currentLeftOffset += necessarySpaceX\n  })\n  return positions;\n  // let t1 = performance.now()\n  // console.log(`Call to calculateLayout took ${t1 - t0} milliseconds.`)\n}","import React, { \n  useState,\n  useRef,\n  useMemo,\n  MutableRefObject,\n  ReactElement,\n  PropsWithChildren,\n} from \"react\";\n// import { useMeasure } from \"react-use\";\nimport { animated, useTransition } from \"react-spring\";\nimport { useMeasure } from \"react-use\";\nimport { calculateLayout } from './helpers'\nimport {\n  defaultMarginTop,\n  defaultMarginRight,\n  defaultMarginBottom,\n  defaultMarginLeft,\n  defaultItemWidth,\n  defaultItemHeight,\n} from \"./defaults\";\nimport { Position } from \"./main\";\n\ninterface Props extends PropsWithChildren<ReactElement>Â {\n  style: {\n    height: number;\n    width: number;\n  }\n}\n\nexport function GridComponent(props: any): ReactElement {\n  \n  const { \n    style: { width: containerWidth },\n    children,\n    itemMarginTop = defaultMarginTop,\n    itemMarginRight = defaultMarginRight,\n    itemMarginBottom = defaultMarginBottom,\n    itemMarginLeft = defaultMarginLeft,\n  } = props\n\n  const positions: MutableRefObject<Position[]> = useRef<Position[]>(\n    new Array(children.length)\n  )\n\n  const refMeasures = children.map(() => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const [size, {width, height}] = useMeasure()\n    return {size, width, height}\n  })\n\n  const gridItems = useMemo(() => {\n\n    calculateLayout(\n      children,\n      itemMarginTop,\n      itemMarginRight,\n      itemMarginBottom,\n      itemMarginLeft,\n      containerWidth\n    ).forEach((e,i) => {\n      positions.current[i] = {\n        ...positions.current[i],\n        ...e\n      }\n    })\n    \n    let gridItemsCalcs = children.map((item: ReactElement, i: number) => {\n      // console.log(`--- start log ---`)\n      // refMeasures.forEach((e: any, i: number) => {\n      //   console.log(`element ${children[i].key} width: ${e.width}`)\n      // })\n      // console.log(`---- end log ----`)\n      return {\n        ...item,\n        top: positions.current[i].top,\n        left: positions.current[i].left,\n        width: refMeasures[i].width\n      }\n    })\n    return gridItemsCalcs\n  }, [\n    // dependencies: container's width, \n    // and size of each contained element\n    containerWidth,\n    refMeasures.map((e:any) => e.width),\n    refMeasures.map((e:any) => e.height)\n  ])\n\n\n\n  const transitions = useTransition(gridItems, el => el.key, {\n    from: ({top, left}) => ({top, left, opacity: 0}),\n    enter: ({top, left}) => ({top, left, opacity: .5}),\n    update: ({top, left}) => ({top, left, opacity: .5}),\n    // config: { mass: 5, tension: 500, friction: 200 },\n  })\n\n  return (\n    <div>\n      <animated.div\n        style={{\n          width: props.style.width,\n          height: props.style.height\n        }}\n        key={1}\n      >\n        { children?.length &&\n          transitions.map((el,i) => {\n            const {item, props: { top, left, width, ...rest }} = el;\n            return (\n            <animated.div\n              key={item.key}\n              style={{\n                position: \"absolute\",\n                border: \"1px solid black\",\n                width,\n                height: refMeasures[i].height,\n                top: top?.interpolate(top => `${top}px`),\n                left: left?.interpolate(left => `${left}px`),\n                ...rest\n              }}\n            >\n              {\n                React.cloneElement(\n                  children[i],\n                  {\n                    ref: refMeasures[i].size\n                  }\n                )\n              }\n            </animated.div>)\n          })}\n      </animated.div>\n    </div>\n  );\n}\n"],"names":["defaultMarginTop","defaultMarginRight","defaultMarginBottom","defaultMarginLeft","defaultItemHeight","calculateLayout","elements","marginTop","marginRight","marginBottom","marginLeft","containerWidth","currentRow","currentTopOffset","currentLeftOffset","spaceRemainingX","nextRow","positions","forEach","e","i","elementWidth","props","style","width","value","necessarySpaceX","push","row","top","left","GridComponent","children","itemMarginTop","itemMarginRight","itemMarginBottom","itemMarginLeft","useRef","Array","length","refMeasures","map","useMeasure","size","height","gridItems","useMemo","current","gridItemsCalcs","item","transitions","useTransition","el","key","from","opacity","enter","update","React","animated","div","rest","position","border","interpolate","cloneElement","ref"],"mappings":"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"}