{"version":3,"file":"index.umd.js","sources":["../src/defaults.ts","../src/helpers.ts","../src/GridComponent.tsx"],"sourcesContent":["export const defaultMarginTop = 10\nexport const defaultMarginRight = 10\nexport const defaultMarginBottom = 10\nexport const defaultMarginLeft = 10\n\nexport const defaultItemHeight = 40;\nexport const defaultItemWidth = 40;","import { Position } from \"./main\"\nimport { AnimatedValue } from 'react-spring'\nimport {\n  defaultMarginRight,\n  defaultMarginLeft,\n  defaultMarginTop,\n  defaultMarginBottom,\n\n  defaultItemHeight,\n  defaultItemWidth\n} from './defaults'\n\nexport const calculateLayout = (\n  elements: React.ReactElement[],\n  marginTop: number,\n  marginRight: number,\n  marginBottom: number,\n  marginLeft: number,\n  containerWidth: number\n): Position[] => {\n  // let t0 = performance.now()\n  let currentRow = 0\n  let currentTopOffset = 0\n  let currentLeftOffset = 0\n  let spaceRemainingX = containerWidth\n  \n  const nextRow = () => {\n    currentRow += 1\n    currentTopOffset += marginTop + defaultItemHeight + marginBottom\n    currentLeftOffset = 0\n    spaceRemainingX = containerWidth\n  }\n\n  const positions: Position[] = []\n  \n  elements.forEach((e, i) => {\n    let elementWidth = e.props.style.width\n    // FIX - If the elements' values are AnimatedValues,\n    // we need to extract the actual width value from there.\n    if (typeof elementWidth === \"object\") {elementWidth = elementWidth.value}\n\n    const necessarySpaceX = marginLeft + elementWidth + marginRight\n    if (\n      // FIXME -- There is a weird behavior because of bigger boxes than the\n      // container width. which makes the grid behave weirdly. Maybe if boxes \n      // are wider than container width we always need to jump line.\n      (spaceRemainingX <= necessarySpaceX && \n      containerWidth > necessarySpaceX) || \n      (necessarySpaceX >= containerWidth && i !== 0)\n    ){\n      nextRow()\n    }\n    positions.push({\n      row: currentRow,\n      top: currentTopOffset + marginTop,\n      left: currentLeftOffset + marginLeft\n    })\n    spaceRemainingX -= necessarySpaceX\n    currentLeftOffset += necessarySpaceX\n  })\n  return positions;\n  // let t1 = performance.now()\n  // console.log(`Call to calculateLayout took ${t1 - t0} milliseconds.`)\n}","import React, { \n  useState,\n  useRef,\n  useMemo,\n  MutableRefObject,\n  ReactElement,\n  PropsWithChildren,\n} from \"react\";\n// import { useMeasure } from \"react-use\";\nimport { animated, useTransition } from \"react-spring\";\nimport { useMeasure } from \"react-use\";\nimport { calculateLayout } from './helpers'\nimport {\n  defaultMarginTop,\n  defaultMarginRight,\n  defaultMarginBottom,\n  defaultMarginLeft,\n  defaultItemWidth,\n  defaultItemHeight,\n} from \"./defaults\";\nimport { Position } from \"./main\";\n\ninterface Props extends PropsWithChildren<ReactElement>Â {\n  style: {\n    height: number;\n    width: number;\n  }\n}\n\nexport function GridComponent(props: any): ReactElement {\n  \n  const { \n    style: { width: containerWidth },\n    children,\n    itemMarginTop = defaultMarginTop,\n    itemMarginRight = defaultMarginRight,\n    itemMarginBottom = defaultMarginBottom,\n    itemMarginLeft = defaultMarginLeft,\n  } = props\n\n  const positions: MutableRefObject<Position[]> = useRef<Position[]>(\n    new Array(children.length)\n  )\n\n  const refMeasures = children.map(() => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const [size, {width, height}] = useMeasure()\n    return {size, width, height}\n  })\n\n  const gridItems = useMemo(() => {\n\n    calculateLayout(\n      children,\n      itemMarginTop,\n      itemMarginRight,\n      itemMarginBottom,\n      itemMarginLeft,\n      containerWidth\n    ).forEach((e,i) => {\n      positions.current[i] = {\n        ...positions.current[i],\n        ...e\n      }\n    })\n    \n    let gridItemsCalcs = children.map((item: ReactElement, i: number) => {\n      // console.log(`--- start log ---`)\n      // refMeasures.forEach((e: any, i: number) => {\n      //   console.log(`element ${children[i].key} width: ${e.width}`)\n      // })\n      // console.log(`---- end log ----`)\n      return {\n        ...item,\n        top: positions.current[i].top,\n        left: positions.current[i].left,\n        width: refMeasures[i].width\n      }\n    })\n    return gridItemsCalcs\n  }, [\n    // dependencies: container's width, \n    // and size of each contained element\n    containerWidth,\n    refMeasures.map((e:any) => e.width),\n    refMeasures.map((e:any) => e.height)\n  ])\n\n\n\n  const transitions = useTransition(gridItems, el => el.key, {\n    from: ({top, left}) => ({top, left, opacity: 0}),\n    enter: ({top, left}) => ({top, left, opacity: .5}),\n    update: ({top, left}) => ({top, left, opacity: .5}),\n    // config: { mass: 5, tension: 500, friction: 200 },\n  })\n\n  return (\n    <div>\n      <animated.div\n        style={{\n          width: props.style.width,\n          height: props.style.height\n        }}\n        key={1}\n      >\n        { children?.length &&\n          transitions.map((el,i) => {\n            const {item, props: { top, left, width, ...rest }} = el;\n            return (\n            <animated.div\n              key={item.key}\n              style={{\n                position: \"absolute\",\n                border: \"1px solid black\",\n                width,\n                height: refMeasures[i].height,\n                top: top?.interpolate(top => `${top}px`),\n                left: left?.interpolate(left => `${left}px`),\n                ...rest\n              }}\n            >\n              {\n                React.cloneElement(\n                  children[i],\n                  {\n                    ref: refMeasures[i].size\n                  }\n                )\n              }\n            </animated.div>)\n          })}\n      </animated.div>\n    </div>\n  );\n}\n"],"names":["defaultMarginTop","defaultMarginRight","defaultMarginBottom","defaultMarginLeft","defaultItemHeight","calculateLayout","elements","marginTop","marginRight","marginBottom","marginLeft","containerWidth","currentRow","currentTopOffset","currentLeftOffset","spaceRemainingX","nextRow","positions","forEach","e","i","elementWidth","props","style","width","value","necessarySpaceX","push","row","top","left","GridComponent","children","itemMarginTop","itemMarginRight","itemMarginBottom","itemMarginLeft","useRef","Array","length","refMeasures","map","useMeasure","size","height","gridItems","useMemo","current","gridItemsCalcs","item","transitions","useTransition","el","key","from","opacity","enter","update","React","animated","div","rest","position","border","interpolate","cloneElement","ref"],"mappings":"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"}